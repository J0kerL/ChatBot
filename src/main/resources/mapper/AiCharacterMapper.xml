<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.chatbot.mapper.AiCharacterMapper">

    <!-- ResultMap: 处理数据库下划线与 Java 驼峰命名的映射 -->
    <resultMap id="BaseResultMap" type="com.chatbot.model.entity.AiCharacter">
        <!-- id 标签用于主键 -->
        <id column="id" property="id" jdbcType="BIGINT"/>
        <!-- result 标签用于普通字段 -->
        <result column="user_id" property="userId" jdbcType="BIGINT"/>
        <result column="name" property="name" jdbcType="VARCHAR"/>
        <result column="relationship" property="relationship" jdbcType="VARCHAR"/>
        <result column="age" property="age" jdbcType="INTEGER"/>
        <result column="appearance" property="appearance" jdbcType="VARCHAR"/>
        <result column="personality_tags" property="personalityTags" jdbcType="VARCHAR" typeHandler="com.chatbot.config.JsonTypeHandler"/>
        <result column="background" property="background" jdbcType="VARCHAR"/>
        <result column="speaking_style" property="speakingStyle" jdbcType="VARCHAR"/>
        <result column="memory_settings" property="memorySettings" jdbcType="VARCHAR"/>
        <result column="avatar" property="avatar" jdbcType="VARCHAR"/>
        <result column="is_template" property="isTemplate" jdbcType="BIT"/>
        <result column="created_at" property="createdAt" jdbcType="TIMESTAMP"/>
    </resultMap>

    <!-- 插入: 返回自增主键 -->
    <insert id="insert" parameterType="com.chatbot.model.dto.AiCharacterDTO" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO ai_character (user_id, name, relationship, age, appearance, personality_tags, background, speaking_style, memory_settings, avatar, is_template, created_at)
        VALUES (#{userId}, #{name}, #{relationship}, #{age}, #{appearance}, #{personalityTags, typeHandler=com.chatbot.config.JsonTypeHandler}, #{background}, #{speakingStyle}, #{memorySettings}, #{avatar}, #{isTemplate}, #{createdAt})
    </insert>

    <!-- 
        7.动态更新 (Selective Update)
        id: 对应接口方法名 (例如 int updateSelective(User user);)
        parameterType: 你的实体类全路径
    -->
    <!--<update id="updateSelective" parameterType="com.example.project.entity.YourEntity">
        &lt;!&ndash; 2. 修改为你的表名 &ndash;&gt;
        UPDATE your_table_name

        &lt;!&ndash; <set> 标签会自动处理最后一个多余的逗号 &ndash;&gt;
        <set>
            &lt;!&ndash; 3. 根据你的实体类属性和数据库字段进行修改 &ndash;&gt;
            &lt;!&ndash; 示例：如果是 String 类型，通常判断 != null 和 != '' &ndash;&gt;
            <if test="username != null and username != ''">
                user_name = #{username},
            </if>

            &lt;!&ndash; 示例：如果是 Integer/Date 等类型，通常只判断 != null &ndash;&gt;
            <if test="age != null">
                age = #{age},
            </if>

            <if test="email != null and email != ''">
                email = #{email},
            </if>

            &lt;!&ndash; 在这里继续添加其他字段... &ndash;&gt;
        </set>

        &lt;!&ndash; 4. 指定主键条件 &ndash;&gt;
        WHERE id = #{id}
    </update>-->
</mapper>